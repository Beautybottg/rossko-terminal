<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>Rossko Terminal</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="logo192.png">
    <link rel="apple-touch-icon" href="logo192.png">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { 
            font-family: 'Inter', -apple-system, system-ui, sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #f9fafb;
            margin: 0;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const CATEGORIES = ['–í—Å–µ', '–ú–∞—Å–ª–∞', '–§–∏–ª—å—Ç—Ä—ã', '–¢–æ—Ä–º–æ–∑–∞', '–ü–æ–¥–≤–µ—Å–∫–∞', '–ü—Ä–æ—á–µ–µ'];
        
        const App = () => {
            const [parts, setParts] = useState([]);
            const [view, setView] = useState('home');
            const [searchQuery, setSearchQuery] = useState('');
            const [activeCategory, setActiveCategory] = useState('–í—Å–µ');
            const [isLoading, setIsLoading] = useState(true);
            const [isUploading, setIsUploading] = useState(false);

            // 1. –ó–ê–ì–†–£–ó–ö–ê –ë–ê–ó–´
            const loadData = async () => {
                setIsLoading(true);
                try {
                    const response = await fetch('data.xlsx?v=' + Date.now()); // –ß–∏—Å—Ç–∏–º –∫—ç—à
                    if (!response.ok) throw new Error("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ");
                    
                    const arrayBuffer = await response.arrayBuffer();
                    const data = new Uint8Array(arrayBuffer);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const ws = workbook.Sheets[workbook.SheetNames[0]];
                    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    
                    const formatted = rows.slice(1).map((row, i) => {
                        if (!row[1]) return null;
                        return {
                            id: row[0] || i,
                            name: String(row[1]),
                            brand: String(row[2] || "Rossko"),
                            article: String(row[3] || "‚Äî"),
                            price: parseFloat(String(row[4]).replace(/[^0-9.]/g, '')) || 0,
                            category: String(row[5] || "–ü—Ä–æ—á–µ–µ")
                        };
                    }).filter(Boolean);

                    setParts(formatted);
                    localStorage.setItem('rossko_cache', JSON.stringify(formatted));
                } catch (e) {
                    const cached = localStorage.getItem('rossko_cache');
                    if (cached) setParts(JSON.parse(cached));
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => { loadData(); }, []);

            // 2. –û–ë–†–ê–ë–û–¢–ö–ê –§–ê–ô–õ–ê (–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä—É—á–Ω—É—é)
            const handleFileUpload = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                setIsUploading(true);

                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const data = new Uint8Array(evt.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const ws = workbook.Sheets[workbook.SheetNames[0]];
                        const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                        
                        const formatted = rows.slice(1).map((row, i) => {
                            if (!row[1]) return null;
                            return {
                                id: row[0] || i,
                                name: String(row[1]),
                                brand: String(row[2] || "Rossko"),
                                article: String(row[3] || "‚Äî"),
                                price: parseFloat(String(row[4]).replace(/[^0-9.]/g, '')) || 0,
                                category: String(row[5] || "–ü—Ä–æ—á–µ–µ")
                            };
                        }).filter(Boolean);

                        setParts(formatted);
                        localStorage.setItem('rossko_cache', JSON.stringify(formatted));
                        alert(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${formatted.length} –ø–æ–∑–∏—Ü–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å.`);
                    } catch (err) {
                        alert("–û—à–∏–±–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ Excel");
                    } finally {
                        setIsUploading(false);
                        e.target.value = '';
                    }
                };
                reader.readAsArrayBuffer(file);
            };

            const filtered = useMemo(() => {
                const q = searchQuery.toLowerCase().trim();
                let result = parts;
                if (activeCategory !== '–í—Å–µ') result = result.filter(p => p.category === activeCategory);
                if (q) {
                    result = result.filter(p => 
                        p.name.toLowerCase().includes(q) || p.article.toLowerCase().includes(q)
                    );
                }
                return result.slice(0, 50);
            }, [parts, searchQuery, activeCategory]);

            if (isLoading) return (
                <div className="flex h-screen items-center justify-center bg-white italic font-black text-blue-600 uppercase tracking-widest text-[10px]">
                    –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24 relative bg-white shadow-2xl overflow-hidden">
                    {/* HOME VIEW */}
                    {view === 'home' && (
                        <div className="p-6 space-y-8 animate-slide-up">
                            <div className="pt-4">
                                <p className="text-[10px] font-black uppercase text-blue-600 mb-1 tracking-widest">Rossko Terminal</p>
                                <h1 className="text-4xl font-black italic uppercase text-gray-800 leading-none">–°–∫–ª–∞–¥—Å–∫–æ–π<br/>–£—á–µ—Ç</h1>
                            </div>
                            <div className="bg-gray-50 border p-5 rounded-3xl flex items-center gap-4" onClick={() => setView('search')}>
                                <span className="text-xl">üîç</span>
                                <span className="text-gray-400 font-bold text-sm">–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –±–∞–∑–µ...</span>
                            </div>
                            <div className="bg-blue-600 rounded-[32px] p-8 text-white shadow-xl relative overflow-hidden">
                                <p className="text-[10px] font-black uppercase opacity-60">–¢–æ–≤–∞—Ä–æ–≤ –≤ –±–∞–∑–µ</p>
                                <p className="text-5xl font-black mt-1">{parts.length}</p>
                                <div className="absolute -right-6 -bottom-6 text-white opacity-10 text-8xl font-black italic">R</div>
                            </div>
                        </div>
                    )}

                    {/* SEARCH VIEW */}
                    {view === 'search' && (
                        <div className="p-4 space-y-4 animate-slide-up">
                            <input 
                                className="w-full bg-gray-50 border-2 border-gray-100 p-5 rounded-[24px] font-bold outline-none focus:border-blue-500 text-lg shadow-inner"
                                placeholder="–ê—Ä—Ç–∏–∫—É–ª –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                            <div className="flex gap-2 overflow-x-auto no-scrollbar">
                                {CATEGORIES.map(c => (
                                    <button key={c} onClick={() => setActiveCategory(c)} className={`px-5 py-2.5 rounded-full text-[10px] font-black uppercase whitespace-nowrap ${activeCategory === c ? 'bg-blue-600 text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}>
                                        {c}
                                    </button>
                                ))}
                            </div>
                            <div className="space-y-3">
                                {filtered.map(p => (
                                    <div key={p.id} className="bg-white border p-5 rounded-[28px] shadow-sm">
                                        <p className="text-[10px] font-black text-blue-600 uppercase mb-1">{p.brand}</p>
                                        <p className="text-sm font-bold leading-tight text-gray-800">{p.name}</p>
                                        <p className="text-[10px] font-mono text-gray-400 mt-2">–ê–†–¢: {p.article}</p>
                                        <p className="text-xl font-black mt-2 text-gray-900">{p.price} ‚ÇΩ</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* MANAGE / WAREHOUSE VIEW */}
                    {view === 'manage' && (
                        <div className="p-6 space-y-6 animate-slide-up">
                            <h2 className="text-3xl font-black uppercase italic text-gray-800">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                            <div className="p-8 border-2 border-dashed border-blue-200 rounded-[32px] bg-white text-center shadow-inner relative">
                                {isUploading ? (
                                    <p className="text-[10px] font-black uppercase text-blue-600 animate-pulse">–û–±—Ä–∞–±–æ—Ç–∫–∞...</p>
                                ) : (
                                    <label className="cursor-pointer block">
                                        <span className="text-3xl block mb-2">üìä</span>
                                        <span className="text-[10px] font-black text-blue-600 uppercase tracking-widest">–û–±–Ω–æ–≤–∏—Ç—å Excel –≤—Ä—É—á–Ω—É—é</span>
                                        <input type="file" accept=".xlsx, .xls" onChange={handleFileUpload} className="hidden" />
                                    </label>
                                )}
                            </div>
                            <button 
                                onClick={loadData}
                                className="w-full py-5 bg-blue-50 text-blue-600 rounded-[24px] font-black uppercase text-[10px] tracking-widest"
                            >
                                –°–±—Ä–æ—Å–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∏–∑ –æ–±–ª–∞–∫–∞
                            </button>
                        </div>
                    )}

                    {/* PROFILE VIEW */}
                    {view === 'profile' && (
                        <div className="p-10 text-center space-y-6 animate-slide-up">
                            <div className="w-24 h-24 bg-blue-50 rounded-[32px] mx-auto flex items-center justify-center text-4xl shadow-inner">üë§</div>
                            <h3 className="text-2xl font-black uppercase">–ü—Ä–æ—Ñ–∏–ª—å</h3>
                            <p className="text-gray-400 text-sm">–ë–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –æ–±–ª–∞–∫–∞</p>
                            <div className="pt-10 space-y-2">
                                <div className="p-4 bg-gray-50 rounded-2xl border text-left flex justify-between items-center">
                                    <span className="text-[10px] font-black uppercase text-gray-400">–í–µ—Ä—Å–∏—è –±–∞–∑—ã</span>
                                    <span className="text-[10px] font-black">{parts.length} –ø–æ–∑.</span>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* NAVIGATION */}
                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-xl border-t flex justify-around py-5 px-2 z-50 rounded-t-[32px] shadow-lg">
                        {[
                            { id: 'home', icon: 'üè†' },
                            { id: 'search', icon: 'üîç' },
                            { id: 'manage', icon: 'üì¶' },
                            { id: 'profile', icon: 'üë§' }
                        ].map(tab => (
                            <button key={tab.id} onClick={() => setView(tab.id)} className={`text-2xl transition-all ${view === tab.id ? 'scale-125 opacity-100' : 'opacity-20'}`}>
                                {tab.icon}
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
