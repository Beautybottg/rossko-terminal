<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>Rossko Terminal</title>
    <link rel="icon" type="image/png" href="logo192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #f9fafb; margin: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .active-tab { color: #2563eb !important; opacity: 1 !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const CATEGORIES = ['–í–°–ï', '–ú–ê–°–õ–ê', '–§–ò–õ–¨–¢–†–´', '–¢–û–†–ú–û–ó–ê', '–ü–û–î–í–ï–°–ö–ê', '–ü–†–û–ß–ï–ï'];

        const App = () => {
            const [parts, setParts] = useState([]);
            const [view, setView] = useState('home');
            const [searchQuery, setSearchQuery] = useState('');
            const [activeCategory, setActiveCategory] = useState('–í–°–ï');
            const [isLoading, setIsLoading] = useState(true);
            const [isUploading, setIsUploading] = useState(false);

            // –ó–ê–ì–†–£–ó–ö–ê –ë–ê–ó–´ (–ü–†–ò–û–†–ò–¢–ï–¢: –û–ë–õ–ê–ö–û)
         const loadData = async (forceRefresh = false) => {
    setIsLoading(true);
    try {
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –∫ —Å—Å—ã–ª–∫–µ, —á—Ç–æ–±—ã –æ–±–º–∞–Ω—É—Ç—å –∫—ç—à Safari
        const url = `data.xlsx?v=${new Date().getTime()}`;
        
        const response = await fetch(url, {
            method: 'GET',
            cache: 'no-store' // –ó–∞–ø—Ä–µ—â–∞–µ–º –±—Ä–∞—É–∑–µ—Ä—É –±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –ø–∞–º—è—Ç–∏
        });
        
        if (!response.ok) throw new Error("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω");
        
        const arrayBuffer = await response.arrayBuffer();
        const data = new Uint8Array(arrayBuffer);
        const workbook = XLSX.read(data, { type: 'array' });
        const ws = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
        
        const formatted = rows.slice(1).map((row, i) => {
            if (!row[1]) return null;
            return {
                id: row[0] || i,
                name: String(row[1]),
                brand: String(row[2] || "Rossko"),
                article: String(row[3] || "‚Äî"),
                price: parseFloat(String(row[4]).replace(/[^0-9.]/g, '')) || 0,
                category: String(row[5] || "–ü–†–û–ß–ï–ï").toUpperCase()
            };
        }).filter(Boolean);

        setParts(formatted);
        localStorage.setItem('rossko_db', JSON.stringify(formatted));
        console.log("–ë–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞");
    } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à:", e);
        const cached = localStorage.getItem('rossko_db');
        if (cached) {
            setParts(JSON.parse(cached));
        } else {
            alert("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª data.xlsx –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ GitHub.");
        }
    } finally {
        setIsLoading(false);
    }
};

            useEffect(() => { loadData(); }, []);

            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ü–û–ò–°–ö (–ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–π –ø–æ–∏—Å–∫)
            const filtered = useMemo(() => {
                const words = searchQuery.toLowerCase().trim().split(/\s+/);
                return parts.filter(p => {
                    const matchCat = activeCategory === '–í–°–ï' || p.category === activeCategory;
                    const content = `${p.name} ${p.article} ${p.brand}`.toLowerCase();
                    const matchQuery = words.every(word => content.includes(word));
                    return matchCat && matchQuery;
                }).slice(0, 50);
            }, [parts, searchQuery, activeCategory]);

            if (isLoading) return <div className="h-screen flex items-center justify-center font-black text-blue-600 italic uppercase text-xs tracking-widest">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–∑—ã...</div>;

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white relative pb-20 shadow-2xl">
                    
                    {view === 'home' && (
                        <div className="p-6 space-y-6">
                            <div className="pt-4">
                                <p className="text-[10px] font-black text-blue-600 tracking-widest uppercase">Rossko Terminal</p>
                                <h1 className="text-4xl font-black italic text-gray-800 uppercase leading-none">–°–∫–ª–∞–¥—Å–∫–æ–π<br/>–£—á–µ—Ç</h1>
                            </div>
                            <div className="bg-blue-600 p-8 rounded-[32px] text-white relative overflow-hidden shadow-xl">
                                <p className="text-[10px] font-black uppercase opacity-60">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                                <p className="text-6xl font-black mt-2">{parts.length}</p>
                                <div className="absolute -right-4 -bottom-4 text-8xl font-black italic opacity-10">R</div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div onClick={() => setView('search')} className="bg-gray-50 p-6 rounded-[24px] border border-gray-100 active:scale-95 transition-all">
                                    <span className="text-2xl">üîç</span>
                                    <p className="font-black uppercase text-[10px] mt-4 text-gray-400">–ü–æ–∏—Å–∫</p>
                                </div>
                                <div onClick={() => setView('manage')} className="bg-gray-50 p-6 rounded-[24px] border border-gray-100 active:scale-95 transition-all">
                                    <span className="text-2xl">üì¶</span>
                                    <p className="font-black uppercase text-[10px] mt-4 text-gray-400">–°–∫–ª–∞–¥</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'search' && (
                        <div className="p-4 space-y-4">
                            <div className="sticky top-0 bg-white/80 backdrop-blur-md pt-2 pb-4 z-10 space-y-4">
                                <input 
                                    className="w-full bg-gray-50 border-2 border-gray-100 p-5 rounded-[24px] font-bold outline-none focus:border-blue-500 text-lg shadow-inner"
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –±–∞–º–ø–µ—Ä vesta"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                                <div className="flex gap-2 overflow-x-auto no-scrollbar">
                                    {CATEGORIES.map(c => (
                                        <button key={c} onClick={() => setActiveCategory(c)} 
                                            className={`px-6 py-3 rounded-full text-[10px] font-black transition-all ${activeCategory === c ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-400'}`}>
                                            {c}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="space-y-4">
                                {filtered.map(p => (
                                    <div key={p.id} className="bg-white border border-gray-100 p-6 rounded-[32px] shadow-sm active:bg-gray-50">
                                        <div className="flex justify-between items-start mb-2">
                                            <span className="text-[10px] font-black text-blue-600 uppercase">{p.brand}</span>
                                            <span className="text-[10px] font-mono text-gray-300">–ê–†–¢: {p.article}</span>
                                        </div>
                                        <p className="font-bold text-gray-800 leading-tight mb-4">{p.name}</p>
                                        <p className="text-2xl font-black text-gray-900">{p.price.toLocaleString()} ‚ÇΩ</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {view === 'manage' && (
                        <div className="p-6 space-y-6">
                            <h2 className="text-3xl font-black italic uppercase text-gray-800">–°–∫–ª–∞–¥</h2>
                            <div className="p-10 border-2 border-dashed border-blue-100 rounded-[40px] bg-blue-50/30 text-center">
                                <label className="cursor-pointer block">
                                    <span className="text-4xl block mb-4">üìä</span>
                                    <span className="text-[10px] font-black text-blue-600 uppercase tracking-widest">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π Excel</span>
                                    <input type="file" className="hidden" accept=".xlsx,.xls" onChange={(e) => {
                                        const file = e.target.files[0];
                                        if(!file) return;
                                        setIsUploading(true);
                                        const reader = new FileReader();
                                        reader.onload = (evt) => {
                                            const wb = XLSX.read(evt.target.result, {type:'array'});
                                            const ws = wb.Sheets[wb.SheetNames[0]];
                                            const json = XLSX.utils.sheet_to_json(ws, {header:1});
                                            
                                            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                                            const rows = json.slice(1).map((row, i) => ({
                                                id: row[0] || i,
                                                name: String(row[1] || ""),
                                                brand: String(row[2] || "Rossko"),
                                                article: String(row[3] || "‚Äî"),
                                                price: parseFloat(String(row[4]).replace(/[^0-9.]/g, '')) || 0,
                                                category: String(row[5] || "–ü–†–û–ß–ï–ï").toUpperCase()
                                            })).filter(r => r.name);

                                            setParts(rows);
                                            localStorage.setItem('rossko_db', JSON.stringify(rows));
                                            setIsUploading(false);
                                            alert("–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ. –ß—Ç–æ–±—ã –æ–Ω –ø–æ—è–≤–∏–ª—Å—è –Ω–∞ –¥—Ä—É–≥–∏—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ –Ω–∞ GitHub –ø–æ–¥ –∏–º–µ–Ω–µ–º data.xlsx");
                                        };
                                        reader.readAsArrayBuffer(file);
                                    }} />
                                </label>
                            </div>
                            <div className="p-6 bg-yellow-50 rounded-[24px] border border-yellow-100">
                                <p className="text-[10px] font-bold text-yellow-700 uppercase leading-relaxed">
                                    –í–Ω–∏–º–∞–Ω–∏–µ: –ß—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å —É –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª <span className="underline">data.xlsx</span> –≤ –≤–∞—à–µ–º GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
                                </p>
                            </div>
                        </div>
                    )}

                    {view === 'profile' && (
                        <div className="p-10 text-center space-y-8">
                            <div className="w-32 h-32 bg-gray-100 rounded-[48px] mx-auto flex items-center justify-center shadow-inner">
                                <span className="text-5xl">üë§</span>
                            </div>
                            <h3 className="text-2xl font-black uppercase text-gray-800">–ü—Ä–æ—Ñ–∏–ª—å</h3>
                            
                            <div className="space-y-3">
                                <button onClick={() => loadData(true)} className="w-full py-5 bg-blue-600 text-white rounded-[24px] font-black uppercase text-[10px] tracking-widest shadow-lg active:scale-95 transition-all">
                                    –û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∏–∑ –æ–±–ª–∞–∫–∞
                                </button>
                                <button onClick={() => { localStorage.clear(); window.location.reload(); }} className="w-full py-5 bg-red-50 text-red-600 rounded-[24px] font-black uppercase text-[10px] tracking-widest active:scale-95 transition-all">
                                    –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                                </button>
                            </div>
                        </div>
                    )}

                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-xl border-t border-gray-100 flex justify-around py-5 px-4 z-50 rounded-t-[32px]">
                        <button onClick={() => setView('home')} className={`text-2xl opacity-20 transition-all ${view === 'home' && 'active-tab scale-125'}`}>üè†</button>
                        <button onClick={() => setView('search')} className={`text-2xl opacity-20 transition-all ${view === 'search' && 'active-tab scale-125'}`}>üîç</button>
                        <button onClick={() => setView('manage')} className={`text-2xl opacity-20 transition-all ${view === 'manage' && 'active-tab scale-125'}`}>üì¶</button>
                        <button onClick={() => setView('profile')} className={`text-2xl opacity-20 transition-all ${view === 'profile' && 'active-tab scale-125'}`}>üë§</button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

