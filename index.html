<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>Rossko Terminal</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="logo192.png">
    <link rel="apple-touch-icon" href="logo192.png">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { 
            font-family: 'Inter', -apple-system, system-ui, sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #f9fafb;
            margin: 0;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const CATEGORIES = ['–í—Å–µ', '–ú–∞—Å–ª–∞', '–§–∏–ª—å—Ç—Ä—ã', '–¢–æ—Ä–º–æ–∑–∞', '–ü–æ–¥–≤–µ—Å–∫–∞', '–ü—Ä–æ—á–µ–µ'];
        
        const App = () => {
            const [parts, setParts] = useState([]);
            const [view, setView] = useState('home');
            const [searchQuery, setSearchQuery] = useState('');
            const [activeCategory, setActiveCategory] = useState('–í—Å–µ');
            const [editingPart, setEditingPart] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            // 1. –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ë–ê–ó–´ –° GITHUB
            useEffect(() => {
                const loadData = async () => {
                    try {
                        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å data.xlsx –∏–∑ –∫–æ—Ä–Ω—è —Å–∞–π—Ç–∞
                        const response = await fetch('data.xlsx');
                        if (!response.ok) throw new Error("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω");
                        
                        const arrayBuffer = await response.arrayBuffer();
                        const data = new Uint8Array(arrayBuffer);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const ws = workbook.Sheets[workbook.SheetNames[0]];
                        
                        // –ß–∏—Ç–∞–µ–º –ø–æ –Ω–æ–º–µ—Ä–∞–º –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                        const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                        const formatted = rows.slice(1).map((row, i) => {
                            if (!row[1]) return null; // –ü—Ä–æ–ø—É—Å–∫ –µ—Å–ª–∏ –Ω–µ—Ç –∏–º–µ–Ω–∏
                            return {
                                id: row[0] || i,
                                name: String(row[1]),
                                brand: String(row[2] || "Rossko"),
                                article: String(row[3] || "‚Äî"),
                                price: parseFloat(String(row[4]).replace(/[^0-9.]/g, '')) || 0,
                                category: String(row[5] || "–ü—Ä–æ—á–µ–µ")
                            };
                        }).filter(Boolean);

                        setParts(formatted);
                        localStorage.setItem('rossko_cache', JSON.stringify(formatted));
                    } catch (e) {
                        console.error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏:", e);
                        // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –±–µ—Ä–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞
                        const cached = localStorage.getItem('rossko_cache');
                        if (cached) setParts(JSON.parse(cached));
                    } finally {
                        setIsLoading(false);
                    }
                };
                loadData();
            }, []);

            // 2. –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ü–û–ò–°–ö (–£–±–∏—Ä–∞–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è)
            const filtered = useMemo(() => {
                const q = searchQuery.toLowerCase().trim();
                let result = parts;

                if (activeCategory !== '–í—Å–µ') {
                    result = result.filter(p => p.category === activeCategory);
                }

                if (q) {
                    result = result.filter(p => 
                        p.name.toLowerCase().includes(q) || 
                        p.article.toLowerCase().includes(q) ||
                        p.brand.toLowerCase().includes(q)
                    );
                }

                return result.slice(0, 50); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            }, [parts, searchQuery, activeCategory]);

            if (isLoading) return (
                <div className="flex h-screen items-center justify-center bg-white">
                    <div className="text-center">
                        <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                        <p className="text-[10px] font-black uppercase tracking-widest text-blue-600">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–∑—ã...</p>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24 relative bg-white shadow-2xl overflow-hidden">
                    {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
                    {view === 'home' && (
                        <div className="p-6 space-y-8 animate-slide-up">
                            <div className="pt-4">
                                <p className="text-[10px] font-black uppercase text-blue-600 mb-1 tracking-widest">Rossko Terminal</p>
                                <h1 className="text-4xl font-black italic uppercase text-gray-800 leading-none text-balance">–°–∫–ª–∞–¥—Å–∫–æ–π<br/>–£—á–µ—Ç</h1>
                            </div>
                            <div className="bg-gray-50 border p-5 rounded-3xl flex items-center gap-4" onClick={() => setView('search')}>
                                <span className="text-xl">üîç</span>
                                <span className="text-gray-400 font-bold text-sm">–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –±–∞–∑–µ...</span>
                            </div>
                            <div className="bg-blue-600 rounded-[32px] p-8 text-white shadow-xl relative overflow-hidden">
                                <p className="text-[10px] font-black uppercase opacity-60">–¢–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞–ª–∏—á–∏–∏</p>
                                <p className="text-5xl font-black mt-1">{parts.length}</p>
                                <div className="absolute -right-6 -bottom-6 text-white opacity-10 text-8xl font-black italic">R</div>
                            </div>
                        </div>
                    )}

                    {view === 'search' && (
                        <div className="p-4 space-y-4 animate-slide-up">
                            <div className="sticky top-0 bg-white/80 backdrop-blur-md pt-2 pb-4 z-10 space-y-4">
                                <input 
                                    className="w-full bg-gray-50 border-2 border-gray-100 p-5 rounded-[24px] font-bold outline-none focus:border-blue-500 transition-all text-lg shadow-inner"
                                    placeholder="–ê—Ä—Ç–∏–∫—É–ª –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                                <div className="flex gap-2 overflow-x-auto no-scrollbar">
                                    {CATEGORIES.map(c => (
                                        <button key={c} onClick={() => setActiveCategory(c)} className={`px-5 py-2.5 rounded-full text-[10px] font-black uppercase whitespace-nowrap transition-all ${activeCategory === c ? 'bg-blue-600 text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}>
                                            {c}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="space-y-3">
                                {filtered.map(p => (
                                    <div key={p.id} className="bg-white border p-5 rounded-[28px] flex justify-between items-center active:scale-[0.98] transition-transform shadow-sm">
                                        <div className="flex-1 pr-4">
                                            <p className="text-[10px] font-black text-blue-600 uppercase mb-1">{p.brand}</p>
                                            <p className="text-sm font-bold leading-tight text-gray-800">{p.name}</p>
                                            <p className="text-[10px] font-mono text-gray-400 mt-2">–ê–†–¢: {p.article}</p>
                                            <p className="text-xl font-black mt-2 text-gray-900">{p.price} ‚ÇΩ</p>
                                        </div>
                                        <div className="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-blue-600 font-black">‚Üí</div>
                                    </div>
                                ))}
                                {filtered.length === 0 && <p className="text-center py-20 text-gray-300 font-black uppercase text-xs">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>}
                                {parts.length > 50 && searchQuery === '' && <p className="text-center text-[10px] text-gray-300 uppercase font-black py-4">–ü–æ–∫–∞–∑–∞–Ω—ã –ø–µ—Ä–≤—ã–µ 50 –ø–æ–∑–∏—Ü–∏–π</p>}
                            </div>
                        </div>
                    )}

                    {view === 'profile' && (
                        <div className="p-10 text-center space-y-6 animate-slide-up">
                            <div className="w-24 h-24 bg-blue-50 rounded-[32px] mx-auto flex items-center justify-center text-4xl shadow-inner">üë§</div>
                            <h3 className="text-2xl font-black uppercase">–ü—Ä–æ—Ñ–∏–ª—å</h3>
                            <p className="text-gray-400 text-sm">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –æ–±–ª–∞–∫–∞</p>
                            <button 
                                onClick={() => window.location.reload()}
                                className="w-full py-4 bg-gray-100 rounded-2xl font-black uppercase text-[10px] text-blue-600"
                            >
                                –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é
                            </button>
                        </div>
                    )}

                    {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-xl border-t flex justify-around py-5 px-2 z-50 rounded-t-[32px] shadow-lg">
                        {[
                            { id: 'home', icon: 'üè†' },
                            { id: 'search', icon: 'üîç' },
                            { id: 'profile', icon: 'üë§' }
                        ].map(tab => (
                            <button key={tab.id} onClick={() => setView(tab.id)} className={`text-2xl transition-all ${view === tab.id ? 'scale-125 opacity-100' : 'opacity-20'}`}>
                                {tab.icon}
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
